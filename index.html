<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>–î–Ω–µ–≤–Ω–∏–∫ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ –ö–æ–ª–∏ ‚Äî v5 (–∫–∞—Ä—Ç–∏–Ω–∫–∏ –∏–∑ /assets/pack)</title>
  <style>
    :root{--bg:#0f1115;--panel:#161a22;--panel2:#1c2230;--text:#e6e8ee;--muted:#9aa3b2;--accent:#6ea8fe;--good:#2dd4bf;--warn:#f59e0b;--bad:#f87171}
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--text);font:16px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,"Noto Sans",sans-serif}
    header{position:sticky;top:0;background:linear-gradient(180deg,var(--bg),rgba(15,17,21,.8));backdrop-filter:blur(6px);z-index:5;border-bottom:1px solid #202534}
    .wrap{max-width:1200px;margin:0 auto;padding:16px}
    h1{font-size:20px;margin:4px 0}
    nav{display:flex;gap:8px;flex-wrap:wrap;margin:8px 0}
    nav button{background:var(--panel);border:1px solid #273043;color:var(--text);padding:8px 12px;border-radius:10px;cursor:pointer}
    nav button.active{border-color:var(--accent);box-shadow:0 0 0 2px rgba(110,168,254,.25) inset}
    section.panel{background:var(--panel);border:1px solid #273043;border-radius:14px;padding:16px;margin:12px 0}
    .row{display:flex;gap:12px;flex-wrap:wrap}
    .row > *{flex:1 1 220px}
    label{font-size:12px;color:var(--muted);display:block;margin-bottom:4px}
    input,select,textarea{width:100%;background:var(--panel2);border:1px solid #2b3548;color:var(--text);padding:10px;border-radius:10px}
    textarea{min-height:80px}
    table{width:100%;border-collapse:collapse}
    th,td{border-bottom:1px solid #273043;padding:10px;vertical-align:top}
    th{color:#b9c1d0;text-align:left}
    .btn{background:#23314a;border:1px solid #2f3f5e;color:#e6e8ee;padding:10px 12px;border-radius:10px;cursor:pointer}
    .btn:hover{filter:brightness(1.1)}
    .btn.ghost{background:transparent;border-color:#2f3f5e}
    .btn.good{background:#123c36;border-color:#1f8a78}
    .btn.bad{background:#3c1212;border-color:#8a1f1f}
    .pill{display:inline-block;padding:.25em .6em;border:1px solid #334155;border-radius:999px;color:#cbd5e1;background:#111827}
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:12px}
    .muted{color:var(--muted)}
    .small{font-size:12px}
    .hidden{display:none}
    .help{font-size:12px;color:#9aa3b2}
    .col-eye{width:70px;text-align:center}
    dialog{border:1px solid #273043;background:#111827;color:#e6e8ee;border-radius:12px;padding:16px;max-width:900px}
    dialog::backdrop{background:rgba(0,0,0,.6)}
    .legend{display:flex;flex-wrap:wrap;gap:8px;margin-top:8px}
    .legend .tag{border:1px solid #334155;background:#0b1220;border-radius:999px;padding:.2em .6em;font-size:12px}
    .atlas{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .panelAtlas{position:relative;background:#0b1220;border:1px solid #22314a;border-radius:12px;overflow:hidden}
    .panelAtlas .title{position:absolute;left:8px;bottom:6px;color:#9aa3b2;font-size:12px;background:rgba(0,0,0,.35);padding:2px 6px;border-radius:6px}
    .panelAtlas .layer{position:absolute;inset:0;width:100%;height:100%;object-fit:fill;opacity:.92;pointer-events:none}
    .panelAtlas .base{position:relative;display:block;width:100%;height:auto}
  @media (max-width: 820px){
  .wrap{padding:12px}
  h1{font-size:18px}
  nav{gap:6px}
  nav button{padding:8px 10px;border-radius:10px}
  input,select,textarea{font-size:16px;padding:12px}
  .btn{padding:12px}
  /* –¢–∞–±–ª–∏—Ü—ã ‚Üí –∫–∞—Ä—Ç–æ—á–∫–∏ */
  table{border:0}
  table thead{display:none}
  table tbody{display:block}
  table tr{display:block;background:var(--panel2);border:1px solid #22314a;border-radius:12px;padding:10px;margin:10px 0}
  table td{display:flex;gap:8px;align-items:center;border-bottom:0;padding:6px 0}
  table td::before{content:attr(data-label);flex:0 0 42%;min-width:120px;color:var(--muted);font-size:12px}
  .col-eye{width:auto;text-align:left}
  .col-eye .btn{width:100%}
}
</style>
</head>
<body>
  <header>
    <div class="wrap">
      <h1>–î–Ω–µ–≤–Ω–∏–∫ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ –ö–æ–ª–∏ ‚Äî v5</h1>
      <nav>
        <button data-tab="today" class="active">–°–µ–≥–æ–¥–Ω—è</button>
        <button data-tab="history">–ò—Å—Ç–æ—Ä–∏—è</button>
        <button data-tab="templates">–®–∞–±–ª–æ–Ω—ã</button>
        <button data-tab="settings">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</button>
      </nav>
    </div>
  </header>

  <main class="wrap">
    <section id="tab-today" class="panel">
      <div class="row">
        <div>
          <label>–î–∞—Ç–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏</label>
          <input type="date" id="dateInput"/>
        </div>
        <div>
          <label>–¢–∏–ø –¥–Ω—è</label>
          <select id="dayType">
            <option value="–î–µ–Ω—å 1">–î–µ–Ω—å 1 ‚Äî –ü–ª–µ—á–∏/–†—É–∫–∏/–ü—Ä–µ—Å—Å</option>
            <option value="–î–µ–Ω—å 2">–î–µ–Ω—å 2 ‚Äî –ù–æ–≥–∏/–Ø–≥–æ–¥–∏—Ü—ã/–ö–æ—Ä</option>
            <option value="–î–µ–Ω—å 3">–î–µ–Ω—å 3 ‚Äî –ì—Ä—É–¥—å/–°–ø–∏–Ω–∞/–ü—Ä–µ—Å—Å</option>
            <option value="–î—Ä—É–≥–æ–π">–î—Ä—É–≥–æ–π</option>
          </select>
        </div>
        <div>
          <label>–û–ø–∏—Å–∞–Ω–∏–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ (–∫–∞–∫ –≤—ã–ø–æ–ª–Ω—è—Ç—å, –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã)</label>
          <input id="descInput" placeholder="–ù–∞–ø—Ä.: —Ç–µ–º–ø 3‚Äë1‚Äë1, –ø–∞—É–∑—ã 60‚Äë90—Å; –ø–æ—Ä—è–¥–æ–∫: —Å–Ω–∞—á–∞–ª–∞ –º–Ω–æ–≥–æ—Å—É—Å—Ç–∞–≤–Ω—ã–µ, –∑–∞—Ç–µ–º –¥–æ–±–∏–≤–∫–∞; –¥–µ—Ä–∂–∞—Ç—å –Ω–µ–π—Ç—Ä–∞–ª—å –≤ –ø–æ—è—Å–Ω–∏—Ü–µ‚Ä¶"/>
        </div>
      </div>

      <div class="help" style="margin:6px 0 10px 0">RPE = —Å—É–±—ä–µ–∫—Ç–∏–≤–Ω–∞—è –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å 1‚Äì10 (10 = –æ—Ç–∫–∞–∑; 8 ‚âà 2 –ø–æ–≤—Ç–æ—Ä–∞ –≤ –∑–∞–ø–∞—Å–µ). <button id="rpeHelp" class="btn ghost" style="padding:6px 8px">–°–ø—Ä–∞–≤–∫–∞ –ø–æ RPE</button></div>

      <h3>–†–∞–∑–º–∏–Ω–∫–∞</h3>
      <table id="warmTable">
        <thead>
          <tr>
            <th style="width:18%">–ù–∞–∑–≤–∞–Ω–∏–µ</th>
            <th style="width:14%">–ú—ã—à—Ü—ã</th>
            <th style="width:12%">–ü–ª–∞–Ω</th>
            <th style="width:12%">–§–∞–∫—Ç</th>
            <th style="width:7%">RPE</th>
            <th style="width:17%">–¢–µ—Ö–Ω–∏–∫–∞</th>
            <th>–ó–∞–º–µ—Ç–∫–∞</th>
            <th class="col-eye">–í–∏–¥</th>
            <th style="width:6%"></th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
      <div class="row" style="justify-content:flex-end;margin:6px 0 18px 0"><button class="btn" data-add="warm">+ –î–æ–±–∞–≤–∏—Ç—å (—Ä–∞–∑–º–∏–Ω–∫–∞)</button></div>

      <h3>–°–∏–ª–æ–≤–∞—è —á–∞—Å—Ç—å</h3>
      <table id="strengthTable">
        <thead>
          <tr>
            <th style="width:18%">–ù–∞–∑–≤–∞–Ω–∏–µ</th>
            <th style="width:14%">–ú—ã—à—Ü—ã</th>
            <th style="width:12%">–ü–ª–∞–Ω</th>
            <th style="width:12%">–§–∞–∫—Ç</th>
            <th style="width:7%">RPE</th>
            <th style="width:17%">–¢–µ—Ö–Ω–∏–∫–∞</th>
            <th>–ó–∞–º–µ—Ç–∫–∞</th>
            <th class="col-eye">–í–∏–¥</th>
            <th style="width:6%"></th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
      <div class="row" style="justify-content:space-between;margin:6px 0 18px 0">
        <button class="btn" data-add="strength">+ –î–æ–±–∞–≤–∏—Ç—å (—Å–∏–ª–æ–≤–∞—è)</button>
        <button class="btn ghost" id="loadTemplateBtn">–ó–∞–≥—Ä—É–∑–∏—Ç—å —à–∞–±–ª–æ–Ω –¥–Ω—è</button>
      </div>

      <h3>–í—ã—Å–æ–∫–æ–∏–Ω—Ç–µ–Ω—Å–∏–≤</h3>
      <table id="hiitTable">
        <thead>
          <tr>
            <th style="width:18%">–ù–∞–∑–≤–∞–Ω–∏–µ</th>
            <th style="width:14%">–ú—ã—à—Ü—ã</th>
            <th style="width:12%">–ü–ª–∞–Ω</th>
            <th style="width:12%">–§–∞–∫—Ç</th>
            <th style="width:7%">RPE</th>
            <th style="width:17%">–¢–µ—Ö–Ω–∏–∫–∞</th>
            <th>–ó–∞–º–µ—Ç–∫–∞</th>
            <th class="col-eye">–í–∏–¥</th>
            <th style="width:6%"></th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
      <div class="row" style="justify-content:flex-end;margin:6px 0 18px 0"><button class="btn" data-add="hiit">+ –î–æ–±–∞–≤–∏—Ç—å (–í–ò–ò–¢)</button></div>

      <h3>–ó–∞–º–∏–Ω–∫–∞</h3>
      <table id="coolTable">
        <thead>
          <tr>
            <th style="width:18%">–ù–∞–∑–≤–∞–Ω–∏–µ</th>
            <th style="width:14%">–ú—ã—à—Ü—ã</th>
            <th style="width:12%">–ü–ª–∞–Ω</th>
            <th style="width:12%">–§–∞–∫—Ç</th>
            <th style="width:7%">RPE</th>
            <th style="width:17%">–¢–µ—Ö–Ω–∏–∫–∞</th>
            <th>–ó–∞–º–µ—Ç–∫–∞</th>
            <th class="col-eye">–í–∏–¥</th>
            <th style="width:6%"></th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
      <div class="row" style="justify-content:flex-end;margin:6px 0 18px 0"><button class="btn" data-add="cool">+ –î–æ–±–∞–≤–∏—Ç—å (–∑–∞–º–∏–Ω–∫–∞)</button></div>

      <details>
        <summary>–ë—ã—Å—Ç—Ä—ã–π –≤–≤–æ–¥ / –≤—Å—Ç–∞–≤–∫–∞ –ø–ª–∞–Ω–∞ –∏–∑ —á–∞—Ç–∞</summary>
        <p class="small muted">–°–µ–∫—Ü–∏–∏: <code>–†–∞–∑–º–∏–Ω–∫–∞:</code>, <code>–°–∏–ª–æ–≤–∞—è:</code>, <code>–í—ã—Å–æ–∫–æ–∏–Ω—Ç–µ–Ω—Å–∏–≤:</code>, <code>–ó–∞–º–∏–Ω–∫–∞:</code>. –°—Ç—Ä–æ–∫–∏: <code>–ù–∞–∑–≤–∞–Ω–∏–µ ‚Äî –º—ã—à—Ü—ã ‚Äî –ø–ª–∞–Ω ‚Äî tip:—Ç–µ—Ö–Ω–∏–∫–∞ ‚Äî note:–∑–∞–º–µ—Ç–∫–∞</code>. <i>¬´tip¬ª –∏ ¬´note¬ª –Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã.</i></p>
<textarea id="bulkText" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä:
–†–∞–∑–º–∏–Ω–∫–∞:
–°—Ç–æ–π–∫–∞ —É —Å—Ç–µ–Ω—ã ‚Äî –ø–ª–µ—á–∏/–∫–æ—Ä ‚Äî 2√ó30—Å ‚Äî tip:–Ω–µ–π—Ç—Ä–∞–ª—å –ø–æ—è—Å–Ω–∏—Ü—ã
–°–∏–ª–æ–≤–∞—è:
–ñ–∏–º –≥–∏—Ä–∏ —Å—Ç–æ—è ‚Äî –¥–µ–ª—å—Ç—ã/—Ç—Ä–∏—Ü–µ–ø—Å ‚Äî 3√ó8/—Ä—É–∫–∞ ‚Äî tip:–ª–æ–∫–æ—Ç—å –ø–æ–¥ –≥–∏—Ä–µ–π
–û—Ç–∂–∏–º–∞–Ω–∏—è –≤ —Ç—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫–µ ‚Äî —Ç—Ä–∏—Ü–µ–ø—Å/–≥—Ä—É–¥—å ‚Äî 3√ó6‚Äì10 ‚Äî note:–ø–æ—Å–ª–µ–¥–Ω–∏–π —Ç—è–∂–µ–ª–æ
–í—ã—Å–æ–∫–æ–∏–Ω—Ç–µ–Ω—Å–∏–≤:
–ö–∞—á–µ–ª–∏ —Å –≥–∏—Ä–µ–π ‚Äî —è–≥–æ–¥–∏—Ü—ã/–±–∏—Ü–µ–ø—Å –±–µ–¥—Ä–∞/–∫–æ—Ä ‚Äî 30—Å √ó 3 (30—Å –æ—Ç–¥—ã—Ö)
–ó–∞–º–∏–Ω–∫–∞:
–ü–ª–µ—á–µ–≤–æ–π –∑–∞–º–æ–∫ ‚Äî –¥–µ–ª—å—Ç—ã/–≥—Ä—É–¥—å ‚Äî 2√ó30—Å"></textarea>
        <div class="row" style="justify-content:flex-end;margin-top:8px"><button class="btn" id="bulkAddBtn">–†–∞–∑–æ–±—Ä–∞—Ç—å –∏ –∑–∞–ø–æ–ª–Ω–∏—Ç—å</button></div>
      </details>

      <div class="row" style="margin-top:14px">
        <div>
          <label>–û–±—â–∏–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π/–æ—Ç—á—ë—Ç</label>
          <textarea id="reportText" placeholder="–ö–∞–∫ –∑–∞—à–ª–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞? –ß—Ç–æ –±—ã–ª–æ –ª–µ–≥–∫–æ/—Ç—è–∂–µ–ª–æ? –°—É–¥–æ—Ä–æ–≥–∏? –ü—É–ª—å—Å?"></textarea>
        </div>
      </div>

      <div class="row" style="justify-content:flex-end;margin-top:10px;gap:8px">
        <button class="btn" id="saveBtn">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É</button>
        <button class="btn good" id="exportTodayBtn">‚¨áÔ∏é –≠–∫—Å–ø–æ—Ä—Ç (JSON)</button>
        <button class="btn ghost" id="copySummaryBtn">üìã –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –æ—Ç—á—ë—Ç –¥–ª—è —Ç—Ä–µ–Ω–µ—Ä–∞</button>
        <button class="btn bad" id="deleteTodayBtn">üóë –£–¥–∞–ª–∏—Ç—å —ç—Ç—É —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É</button>
      </div>
    </section>

    <section id="tab-history" class="panel hidden">
      <div class="grid">
        <div class="kpi"><h3>–¢—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ –∑–∞ –ø–µ—Ä–∏–æ–¥</h3><div class="num" id="kpiSessions">0</div></div>
        <div class="kpi"><h3>–û–±—â–∏—Ö –ø–æ–¥—Ö–æ–¥–æ–≤ (—Ñ–∞–∫—Ç)</h3><div class="num" id="kpiSets">0</div></div>
        <div class="kpi"><h3>–°—Ä–µ–¥–Ω–∏–π RPE</h3><div class="num" id="kpiRpe">‚Äî</div></div>
      </div>

      <div class="row" style="margin-top:12px">
        <div>
          <label>–ü–µ—Ä–∏–æ–¥ —Å</label>
          <input type="date" id="fromDate">
        </div>
        <div>
          <label>–ø–æ</label>
          <input type="date" id="toDate">
        </div>
        <div>
          <label>–§–∏–ª—å—Ç—Ä –ø–æ —Ç–∏–ø—É –¥–Ω—è</label>
          <select id="filterDay">
            <option value="">–í—Å–µ</option>
            <option value="–î–µ–Ω—å 1">–î–µ–Ω—å 1</option>
            <option value="–î–µ–Ω—å 2">–î–µ–Ω—å 2</option>
            <option value="–î–µ–Ω—å 3">–î–µ–Ω—å 3</option>
          </select>
        </div>
        <div class="row" style="justify-content:flex-end;align-items:flex-end">
          <button class="btn" id="refreshHistory">–û–±–Ω–æ–≤–∏—Ç—å</button>
          <button class="btn good" id="exportRangeJson">–≠–∫—Å–ø–æ—Ä—Ç JSON</button>
          <button class="btn" id="exportRangeCsv">–≠–∫—Å–ø–æ—Ä—Ç CSV</button>
          <label class="btn ghost" style="position:relative;overflow:hidden">
            ‚¨ÜÔ∏é –ò–º–ø–æ—Ä—Ç JSON
            <input type="file" id="importFile" accept="application/json" style="position:absolute;inset:0;opacity:0;cursor:pointer">
          </label>
        </div>
      </div>

      <table id="historyTable" style="margin-top:10px">
        <thead>
          <tr>
            <th style="width:110px">–î–∞—Ç–∞</th>
            <th style="width:90px">–î–µ–Ω—å</th>
            <th>–°—Ç—Ä–æ–∫ (–≤—Å–µ —Å–µ–∫—Ü–∏–∏)</th>
            <th style="width:80px">–ü–æ–¥—Ö–æ–¥—ã</th>
            <th style="width:80px">–°—Ä–µ–¥–Ω. RPE</th>
            <th style="width:110px"></th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </section>

    <section id="tab-templates" class="panel hidden">
      <p class="small muted">–®–∞–±–ª–æ–Ω—ã –º–æ–∂–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∏ –∑–∞–≥—Ä—É–∂–∞—Ç—å —Ü–µ–ª–∏–∫–æ–º –≤ ¬´–°–µ–≥–æ–¥–Ω—è¬ª.</p>
      <div class="grid" id="templatesGrid"></div>
    </section>

    <section id="tab-settings" class="panel hidden">
      <div class="grid">
        <div>
          <label>–ò–º—è</label>
          <input id="nameInput" placeholder="–ö–æ–ª—è" />
        </div>
        <div>
          <label>–¶–µ–ª—å</label>
          <input id="goalInput" placeholder="–°–∏–ª–∞ + –≤—ã–Ω–æ—Å–ª–∏–≤–æ—Å—Ç—å + ¬´–ê–Ω—Ç–∏–±–æ–∫–∞¬ª" />
        </div>
        <div>
          <label>–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</label>
          <input id="gearInput" placeholder="–ì–∏—Ä—è 16 –∫–≥, –≥–∞–Ω—Ç–µ–ª—å 10 –∫–≥, —Ä–µ–∑–∏–Ω–∫–∏, —Ä–æ–ª–∏–∫, –¥–∏–≤–∞–Ω/—Å—Ç—É–ª" />
        </div>
      </div>
      <div class="row" style="justify-content:flex-end;margin-top:10px;gap:8px">
        <button class="btn" id="saveProfile">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å</button>
        <button class="btn bad" id="wipeAll">–°—Ç–µ—Ä–µ—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ (–ª–æ–∫–∞–ª—å–Ω–æ)</button>
      </div>
      <p class="muted small">–î–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –±—Ä–∞—É–∑–µ—Ä–µ (localStorage). –ò—Å–ø–æ–ª—å–∑—É–π —ç–∫—Å–ø–æ—Ä—Ç/–∏–º–ø–æ—Ä—Ç –¥–ª—è —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏–π –∏ –ø–µ—Ä–µ–Ω–æ—Å–∞.</p>
    </section>
  </main>

  <dialog id="rpeModal">
    <h3>RPE ‚Äî —Å—É–±—ä–µ–∫—Ç–∏–≤–Ω–∞—è —Ç—è–∂–µ—Å—Ç—å –ø–æ–¥—Ö–æ–¥–∞ (1‚Äì10)</h3>
    <ul class="small">
      <li><b>6‚Äì7</b> ‚Äî –ª–µ–≥–∫–æ, –æ—Å—Ç–∞–ª–æ—Å—å 3‚Äì4 –ø–æ–≤—Ç–æ—Ä–∞ –≤ –∑–∞–ø–∞—Å–µ</li>
      <li><b>8</b> ‚Äî —Ä–∞–±–æ—á–∞—è —Ç—è–∂–µ—Å—Ç—å, ~2 –ø–æ–≤—Ç–æ—Ä–∞ –≤ –∑–∞–ø–∞—Å–µ</li>
      <li><b>9</b> ‚Äî —Ç—è–∂–µ–ª–æ, ~1 –ø–æ–≤—Ç–æ—Ä –≤ –∑–∞–ø–∞—Å–µ</li>
      <li><b>10</b> ‚Äî –æ—Ç–∫–∞–∑, –∑–∞–ø–∞—Å = 0</li>
    </ul>
    <div class="row" style="justify-content:flex-end"><button class="btn" id="closeRpe">–ó–∞–∫—Ä—ã—Ç—å</button></div>
  </dialog>

  <dialog id="muscleModal">
    <h3>–ó–∞–¥–µ–π—Å—Ç–≤–æ–≤–∞–Ω–Ω—ã–µ –º—ã—à—Ü—ã</h3>
    <div id="muscleFigure" class="atlas"></div>
    <div id="muscleLegend" class="legend"></div>
    <div class="row" style="justify-content:flex-end"><button class="btn" id="closeMuscle">–ó–∞–∫—Ä—ã—Ç—å</button></div>
  </dialog>

  <script>
  (()=>{
    const KEY='kolyaTrainingV1';
    const $=(s)=>document.querySelector(s); const $$=(s)=>Array.from(document.querySelectorAll(s));

    // ==== –ù–∞–≤–∏–≥–∞—Ü–∏—è
    const panels={today:'#tab-today',history:'#tab-history',templates:'#tab-templates',settings:'#tab-settings'};
    $$('.wrap nav button').forEach(btn=>{ btn.addEventListener('click',()=>{ $$('.wrap nav button').forEach(b=>b.classList.remove('active')); btn.classList.add('active'); Object.values(panels).forEach(sel=>$(sel).classList.add('hidden')); $(panels[btn.dataset.tab]).classList.remove('hidden'); if(btn.dataset.tab==='history') renderHistory(); if(btn.dataset.tab==='templates') renderTemplates(); if(btn.dataset.tab==='settings') renderSettings(); }); });

    // ==== –°–æ—Å—Ç–æ—è–Ω–∏–µ
    const state=loadState();
    function loadState(){ try{ const raw=localStorage.getItem(KEY); const base= raw? JSON.parse(raw): {profile:defProfile(),sessions:[],templates:defTemplates()}; base.sessions=(base.sessions||[]).map(s=>({...s, strength:s.strength||s.exercises||[], warm:s.warm||s.warmup?.map(n=>({name:n}))||[], cool:s.cool||s.cooldown?.map(n=>({name:n}))||[], hiit:s.hiit||[]})); return base; }catch(e){ return {profile:defProfile(),sessions:[],templates:defTemplates()}; } }
    function saveState(){ localStorage.setItem(KEY,JSON.stringify(state)); }
    function defProfile(){ return {name:'–ö–æ–ª—è',goal:'–°–∏–ª–∞ + –≤—ã–Ω–æ—Å–ª–∏–≤–æ—Å—Ç—å + –ê–Ω—Ç–∏–±–æ–∫–∞',gear:'–ì–∏—Ä—è 16 –∫–≥; –≥–∞–Ω—Ç–µ–ª—å 10 –∫–≥; —Ä–µ–∑–∏–Ω–∫–∏; —Ä–æ–ª–∏–∫; —Å—Ç—É–ª/–¥–∏–≤–∞–Ω'}; }

    // ==== –®–∞–±–ª–æ–Ω—ã
    function defTemplates(){ return [
      {id:'d1',title:'–î–µ–Ω—å 1 ‚Äî –ü–ª–µ—á–∏/–†—É–∫–∏/–ü—Ä–µ—Å—Å',desc:'–°–∏–ª–æ–≤–∞—è –ø–æ –ø–æ–¥—Ö–æ–¥–∞–º, –æ—Ç–¥—ã—Ö 60‚Äì90—Å.',
       warm:[{name:'–°—Ç–æ–π–∫–∞ —É —Å—Ç–µ–Ω—ã',muscles:'–ø–ª–µ—á–∏/–∫–æ—Ä',plan:'2√ó30—Å',tip:'–ª–∏—Ü–æ–º/—Å–ø–∏–Ω–æ–π, –Ω–µ–π—Ç—Ä–∞–ª—å –ø–æ—è—Å–Ω–∏—Ü—ã'}],
       strength:[{name:'–ñ–∏–º –≥–∏—Ä–∏ —Å—Ç–æ—è',muscles:'–¥–µ–ª—å—Ç—ã/—Ç—Ä–∏—Ü–µ–ø—Å',plan:'3√ó8/—Ä—É–∫–∞',tip:'–ª–æ–∫–æ—Ç—å –ø–æ–¥ –≥–∏—Ä–µ–π'},{name:'–û—Ç–∂–∏–º–∞–Ω–∏—è –≤ —Ç—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫–µ',muscles:'—Ç—Ä–∏—Ü–µ–ø—Å/–≥—Ä—É–¥—å',plan:'3√ó6‚Äì10',tip:'–ª–æ–∫—Ç–∏ –≤–¥–æ–ª—å –∫–æ—Ä–ø—É—Å–∞'},{name:'–°–≥–∏–±–∞–Ω–∏—è —Å —Ä–µ–∑–∏–Ω–∫–æ–π (21 –º–µ—Ç–æ–¥)',muscles:'–±–∏—Ü–µ–ø—Å',plan:'3√ó21'},{name:'–§—Ä–∞–Ω—Ü—É–∑—Å–∫–∏–π –∂–∏–º —Å –≥–∏—Ä–µ–π',muscles:'—Ç—Ä–∏—Ü–µ–ø—Å',plan:'3√ó10‚Äì12'}],
       hiit:[{name:'–ö–∞—á–µ–ª–∏ —Å –≥–∏—Ä–µ–π',muscles:'—è–≥–æ–¥–∏—Ü—ã/–±–∏—Ü–µ–ø—Å –±–µ–¥—Ä–∞/–∫–æ—Ä',plan:'30—Å √ó 3 (30—Å –æ—Ç–¥—ã—Ö)'}],
       cool:[{name:'–ü–ª–µ—á–µ–≤–æ–π –∑–∞–º–æ–∫',muscles:'–¥–µ–ª—å—Ç—ã/–≥—Ä—É–¥—å',plan:'2√ó30—Å'},{name:'–ü–∞–Ω–∫–µ–π–∫',muscles:'–ø—Ä–∏–≤–æ–¥—è—â–∏–µ/–±–∏—Ü–µ–ø—Å –±–µ–¥—Ä–∞',plan:'60—Å'}]},
      {id:'d2',title:'–î–µ–Ω—å 2 ‚Äî –ù–æ–≥–∏/–Ø–≥–æ–¥–∏—Ü—ã/–ö–æ—Ä',desc:'–¢–µ–º–ø –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º—ã–π; –ø–∞—É–∑–∞ 1—Å –≤–Ω–∏–∑—É –≤ –ø–µ—Ä–≤–æ–º —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–∏.',
       warm:[{name:'–ö–∞–∑–∞—á—å–∏ –ø—Ä–∏—Å–µ–¥–∞–Ω–∏—è',muscles:'–ø—Ä–∏–≤–æ–¥—è—â–∏–µ/–∫–≤–∞–¥—Ä–∏—Ü–µ–ø—Å—ã',plan:'2√ó6/–Ω–æ–≥–∞'}],
       strength:[{name:'–ì–æ–±–ª–µ—Ç-–ø—Ä–∏—Å–µ–¥ (3-1-1)',muscles:'–∫–≤–∞–¥—Ä–∏—Ü–µ–ø—Å—ã/—è–≥–æ–¥–∏—Ü—ã',plan:'3√ó10‚Äì12'},{name:'–í—ã–ø–∞–¥ –Ω–∞–∑–∞–¥ —Å –≥–∞–Ω—Ç–µ–ª—å—é',muscles:'–∫–≤–∞–¥—Ä–∏—Ü–µ–ø—Å—ã/—è–≥–æ–¥–∏—Ü—ã',plan:'3√ó10/–Ω–æ–≥–∞'},{name:'–†—É–º—ã–Ω—Å–∫–∞—è —Ç—è–≥–∞ —Å –≥–∏—Ä–µ–π',muscles:'–±–∏—Ü–µ–ø—Å –±–µ–¥—Ä–∞/—è–≥–æ–¥–∏—Ü—ã',plan:'3√ó10'},{name:'–ö—Ä–∞–± —Å —Ä–µ–∑–∏–Ω–∫–æ–π',muscles:'—Å—Ä–µ–¥–Ω—è—è —è–≥–æ–¥–∏—á–Ω–∞—è',plan:'3√ó12+12 —à–∞–≥–æ–≤'}],
       hiit:[{name:'–°–∫–µ–π—Ç‚Äë–ø—Ä—ã–∂–∫–∏',muscles:'—è–≥–æ–¥–∏—Ü—ã/–±–∏—Ü–µ–ø—Å –±–µ–¥—Ä–∞/–∏–∫—Ä—ã',plan:'3√ó30—Å/30—Å'}],
       cool:[{name:'–†–∞—Å—Ç—è–∂–∫–∞ –±–∏—Ü–µ–ø—Å–∞ –±–µ–¥—Ä–∞',muscles:'–±–∏—Ü–µ–ø—Å –±–µ–¥—Ä–∞',plan:'2√ó30—Å/–Ω–æ–≥–∞'}]},
      {id:'d3',title:'–î–µ–Ω—å 3 ‚Äî –ì—Ä—É–¥—å/–°–ø–∏–Ω–∞/–ü—Ä–µ—Å—Å',desc:'–§–æ–∫—É—Å –Ω–∞ —Ä–∞–±–æ—Ç–µ –ª–æ–ø–∞—Ç–æ–∫ –∏ –Ω–µ–π—Ç—Ä–∞–ª–∏ –≤ –ø–æ—è—Å–Ω–∏—Ü–µ.',
       warm:[{name:'–†–∞–∑–≤–µ–¥–µ–Ω–∏—è —Å —Ä–µ–∑–∏–Ω–∫–æ–π',muscles:'–∑–∞–¥–Ω—è—è –¥–µ–ª—å—Ç–∞/—Ä–æ–º–±–æ–≤–∏–¥–Ω—ã–µ',plan:'2√ó15'}],
       strength:[{name:'–û—Ç–∂–∏–º–∞–Ω–∏—è –Ω–∞ –¥–∏–≤–∞–Ω–µ (–ø–∞—É–∑–∞)',muscles:'–≥—Ä—É–¥—å/—Ç—Ä–∏—Ü–µ–ø—Å',plan:'3√ó8‚Äì10'},{name:'–¢—è–≥–∞ –≥–∏—Ä–∏ –≤ –Ω–∞–∫–ª–æ–Ω–µ',muscles:'—à–∏—Ä–æ—á–∞–π—à–∏–µ/—Ä–æ–º–±–æ–≤–∏–¥–Ω—ã–µ',plan:'3√ó10/—Ä—É–∫–∞'},{name:'–ü—É–ª–æ–≤–µ—Ä —Å –≥–∞–Ω—Ç–µ–ª—å—é',muscles:'–≤–µ—Ä—Ö –≥—Ä—É–¥–∏/—à–∏—Ä–æ—á–∞–π—à–∏–µ',plan:'3√ó12'},{name:'–†–∞–∑–≤–µ–¥–µ–Ω–∏—è —Å —Ä–µ–∑–∏–Ω–∫–æ–π –≤ –Ω–∞–∫–ª–æ–Ω–µ',muscles:'–∑–∞–¥–Ω—è—è –¥–µ–ª—å—Ç–∞',plan:'3√ó12‚Äì15'}],
       hiit:[{name:'–ë–µ—Ä–ø–∏',muscles:'–∫–æ—Ä/–Ω–æ–≥–∏/–ø–ª–µ—á–∏',plan:'3√ó20—Å/40—Å'}],
       cool:[{name:'–†–∞—Å—Ç—è–∂–∫–∞ –≥—Ä—É–¥–∏ —É –¥–≤–µ—Ä–∏',muscles:'–≥—Ä—É–¥—å/–¥–µ–ª—å—Ç—ã',plan:'2√ó30—Å'}]}
    ]; }

    // ==== –≠–ª–µ–º–µ–Ω—Ç—ã
    const dateInput=$('#dateInput'); const dayType=$('#dayType'); const descInput=$('#descInput'); const reportText=$('#reportText');
    try{dateInput.valueAsDate=new Date();}catch(_){ }

    const tables={warm:$('#warmTable tbody'),strength:$('#strengthTable tbody'),hiit:$('#hiitTable tbody'),cool:$('#coolTable tbody')};
    $$('[data-add]').forEach(btn=> btn.addEventListener('click',()=> addRow(btn.dataset.add)));

    function addRow(section,item={}){
      const tb=tables[section]; const tr=document.createElement('tr');
      tr.innerHTML=`
        <td><input value="${esc(item.name||'')}" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ"></td>
        <td><input value="${esc(item.muscles||'')}" placeholder="–ú—ã—à—Ü—ã (–Ω–∞–ø—Ä. –≥—Ä—É–¥—å/—Ç—Ä–∏—Ü–µ–ø—Å)"></td>
        <td><input value="${esc(item.plan||'')}" placeholder="–ü–ª–∞–Ω (–Ω–∞–ø—Ä. 3√ó10 / 30—Å)"></td>
        <td><input value="${esc(item.fact||'')}" placeholder="–§–∞–∫—Ç (–Ω–∞–ø—Ä. 3√ó8)"></td>
        <td><input value="${esc(item.rpe||'')}" placeholder="RPE"></td>
        <td><input value="${esc(item.tip||'')}" placeholder="–¢–µ—Ö–Ω–∏–∫–∞ (–º–æ–∏ –ø–æ–¥—Å–∫–∞–∑–∫–∏)"></td>
        <td><input value="${esc(item.note||'')}" placeholder="–ó–∞–º–µ—Ç–∫–∞ (—Ç–≤–æ—ë –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ)"></td>
        <td class="col-eye"><button class="btn ghost eye" title="–ü–æ–∫–∞–∑–∞—Ç—å –º—ã—à—Ü—ã">üëÅ</button></td>
        <td><button class="btn ghost del" title="–£–¥–∞–ª–∏—Ç—å">√ó</button></td>`;
      // –º–µ—Ç–∫–∏ –¥–ª—è –º–æ–±–∏–ª—å–Ω–æ–π –≤—ë—Ä—Å—Ç–∫–∏
      const labels=['–ù–∞–∑–≤–∞–Ω–∏–µ','–ú—ã—à—Ü—ã','–ü–ª–∞–Ω','–§–∞–∫—Ç','RPE','–¢–µ—Ö–Ω–∏–∫–∞','–ó–∞–º–µ—Ç–∫–∞','–í–∏–¥',''];
      tr.querySelectorAll('td').forEach((td,i)=> td.dataset.label = labels[i] || '');
      tr.querySelector('.del').addEventListener('click',()=> tr.remove());
      tr.querySelector('.eye').addEventListener('click',()=>{ const mus=tr.querySelectorAll('input')[1].value; showMuscles(mus); });
      tb.appendChild(tr);
    }

    // –ó–∞–≥—Ä—É–∑–∫–∞ —à–∞–±–ª–æ–Ω–∞ –¥–Ω—è
    $('#loadTemplateBtn').addEventListener('click',()=>{ const t=state.templates.find(t=>t.title.startsWith(dayType.value)); if(!t) return alert('–ù–µ—Ç —à–∞–±–ª–æ–Ω–∞ –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –¥–Ω—è'); Object.values(tables).forEach(tb=> tb.innerHTML=''); (t.warm||[]).forEach(i=> addRow('warm',i)); (t.strength||[]).forEach(i=> addRow('strength',i)); (t.hiit||[]).forEach(i=> addRow('hiit',i)); (t.cool||[]).forEach(i=> addRow('cool',i)); descInput.value=t.desc||''; window.scrollTo({top:0,behavior:'smooth'}); });

    // –ë—ã—Å—Ç—Ä—ã–π –≤–≤–æ–¥ (tip:/note:)
    $('#bulkAddBtn').addEventListener('click',()=>{ const txt=($('#bulkText').value||'').trim(); if(!txt) return; parseBulk(txt); $('#bulkText').value=''; });
    function parseBulk(text){ Object.values(tables).forEach(tb=> tb.innerHTML=''); let sec='strength'; text.split(/\n+/).forEach(raw=>{ const line=raw.trim(); if(!line) return; const l=line.toLowerCase(); if(/^—Ä–∞–∑–º–∏–Ω–∫–∞/.test(l)){sec='warm';return} if(/^(–≤—ã—Å–æ–∫–æ–∏–Ω—Ç–µ–Ω—Å–∏–≤|–≤–∏–∏—Ç|fin|hiit)/.test(l)){sec='hiit';return} if(/^(–∑–∞–º–∏–Ω–∫–∞|—Ä–∞—Å—Ç—è–∂)/.test(l)){sec='cool';return} if(/^(—Å–∏–ª–æ–≤–∞|—É–ø—Ä–∞–∂–Ω–µ–Ω)/.test(l)){sec='strength';return} const parts=line.split('‚Äî').map(s=> s.trim()); const obj={}; obj.name=parts[0]||''; if(parts[1]&&!/^tip:|^note:/.test(parts[1])) obj.muscles=parts[1]; const rest=parts.slice( obj.muscles?2:1).join(' ‚Äî '); const tokens=rest.split(/\s‚Äî\s|\s;\s/); tokens.forEach(t=>{ const m=t.match(/^tip:(.*)/i); const n=t.match(/^note:(.*)/i); if(m) obj.tip=m[1].trim(); else if(n) obj.note=n[1].trim(); else if(!obj.plan) obj.plan=t.trim(); }); addRow(sec,obj); }); }

    // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ / —ç–∫—Å–ø–æ—Ä—Ç / –æ—Ç—á—ë—Ç / —É–¥–∞–ª–µ–Ω–∏–µ
    $('#saveBtn').addEventListener('click',()=>{ saveSession(); alert('–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ ‚úÖ'); });
    $('#deleteTodayBtn').addEventListener('click',()=>{ const id=currentId(); const before=state.sessions.length; state.sessions=state.sessions.filter(s=> s.id!==id); saveState(); alert(before===state.sessions.length?'–ù–µ –Ω–∞–π–¥–µ–Ω–æ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ –Ω–∞ —ç—Ç—É –¥–∞—Ç—É/–¥–µ–Ω—å':'–£–¥–∞–ª–µ–Ω–æ ‚úÖ'); });
    $('#exportTodayBtn').addEventListener('click',()=>{ const s=collectSession(); download(`session_${s.date}.json`, JSON.stringify(s,null,2)); });
    $('#copySummaryBtn').addEventListener('click',()=>{ const s=collectSession(); const lines=[]; lines.push(`–î–∞—Ç–∞: ${s.date} ‚Äî ${s.dayType}`); if(s.desc) lines.push(`–û–ø–∏—Å–∞–Ω–∏–µ: ${s.desc}`); function dump(title,arr){ if(!arr||!arr.length) return; lines.push(`${title}:`); arr.forEach(i=> lines.push(`‚Ä¢ ${i.name}${i.muscles?` (${i.muscles})`:''} ‚Äî –ø–ª–∞–Ω: ${i.plan||'‚Äî'}; —Ñ–∞–∫—Ç: ${i.fact||'‚Äî'}${i.rpe?`; RPE: ${i.rpe}`:''}${i.tip?`; —Ç–µ—Ö–Ω–∏–∫–∞: ${i.tip}`:''}${i.note?`; –∑–∞–º–µ—Ç–∫–∞: ${i.note}`:''}`)); } dump('–†–∞–∑–º–∏–Ω–∫–∞',s.warm); dump('–°–∏–ª–æ–≤–∞—è',s.strength); dump('–í—ã—Å–æ–∫–æ–∏–Ω—Ç–µ–Ω—Å–∏–≤',s.hiit); dump('–ó–∞–º–∏–Ω–∫–∞',s.cool); if(s.report) lines.push(`–û—Ç—á—ë—Ç: ${s.report}`); navigator.clipboard.writeText(lines.join('\n')).then(()=> alert('–û—Ç—á—ë—Ç —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω ‚úÖ')).catch(()=> alert('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å')); });

    function currentId(){ const d=dateInput.value || new Date().toISOString().slice(0,10); return `${d}_${dayType.value}`.replace(/\s+/g,'_'); }
    function collectSection(tb){ return Array.from(tb.querySelectorAll('tr')).map(tr=>{ const [n,m,p,f,rpe,tip,note]=Array.from(tr.querySelectorAll('input')); return {name:n.value.trim(),muscles:(m.value||'').trim(),plan:(p.value||'').trim(),fact:(f.value||'').trim(),rpe:(rpe.value||'').trim(),tip:(tip.value||'').trim(),note:(note.value||'').trim()}; }).filter(i=> i.name || i.plan || i.fact); }
    function collectSession(){ const date=dateInput.value || new Date().toISOString().slice(0,10); return {id:currentId(),date,dayType:dayType.value,desc:(descInput.value||'').trim(),report:(reportText.value||'').trim(),warm:collectSection(tables.warm),strength:collectSection(tables.strength),hiit:collectSection(tables.hiit),cool:collectSection(tables.cool)}; }
    function saveSession(){ const s=collectSession(); state.sessions=state.sessions.filter(x=> x.id!==s.id); state.sessions.push(s); state.sessions.sort((a,b)=> a.date.localeCompare(b.date)); saveState(); }

    // ==== –ò—Å—Ç–æ—Ä–∏—è
    const historyTbody=$('#historyTable tbody'); const fromDate=$('#fromDate'); const toDate=$('#toDate'); const filterDay=$('#filterDay');
    $('#refreshHistory').addEventListener('click',renderHistory);
    $('#exportRangeJson').addEventListener('click',()=>{ const arr=filteredSessions(); download(`sessions_${fromDate.value||'all'}_${toDate.value||'all'}.json`, JSON.stringify(arr,null,2)); });
    $('#exportRangeCsv').addEventListener('click',()=>{ const arr=filteredSessions(); const rows=[["date","day","section","exercise","plan","fact","rpe","tip","note"]]; arr.forEach(s=>{ [['warm','–†–∞–∑–º–∏–Ω–∫–∞'],['strength','–°–∏–ª–æ–≤–∞—è'],['hiit','–í—ã—Å–æ–∫–æ–∏–Ω—Ç–µ–Ω—Å–∏–≤'],['cool','–ó–∞–º–∏–Ω–∫–∞']].forEach(([key,secName])=> (s[key]||[]).forEach(e=> rows.push([s.date,s.dayType,secName,e.name,e.plan||'',e.fact||'',e.rpe||'',e.tip||'',e.note||''])) ); }); const csv=rows.map(r=> r.map(x=>`"${(x||'').replace(/"/g,'""')}` ).join(',')).join('\n'); download(`sessions_${fromDate.value||'all'}_${toDate.value||'all'}.csv`, csv); });
    $('#importFile').addEventListener('change',(e)=>{ const file=e.target.files?.[0]; if(!file) return; const r=new FileReader(); r.onload=()=>{ try{ const arr=JSON.parse(r.result); if(!Array.isArray(arr)) return alert('–û–∂–∏–¥–∞–ª—Å—è –º–∞—Å—Å–∏–≤ —Å–µ—Å—Å–∏–π'); const map=new Map(state.sessions.map(s=>[s.id,s])); arr.forEach(s=> map.set(s.id,s)); state.sessions=[...map.values()].sort((a,b)=> a.date.localeCompare(b.date)); saveState(); renderHistory(); alert('–ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ ‚úÖ'); }catch(_){ alert('–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è —Ñ–∞–π–ª–∞'); } }; r.readAsText(file); e.target.value=''; });
    function filteredSessions(){ const fd=fromDate.value? new Date(fromDate.value):null; const td=toDate.value? new Date(toDate.value):null; return state.sessions.filter(s=>{ const d=new Date(s.date); if(fd && d<fd) return false; if(td && d>td) return false; if(filterDay.value && s.dayType!==filterDay.value) return false; return true; }); }
    function renderHistory(){ if(!fromDate.value && !toDate.value){ const d=new Date(); const start=new Date(d.getFullYear(),d.getMonth(),d.getDate()-30); try{fromDate.valueAsDate=start; toDate.valueAsDate=d;}catch(_){}} const arr=filteredSessions(); historyTbody.innerHTML=''; let totalSets=0,rpeSum=0,rpeCnt=0; arr.forEach(s=>{ const all=[...(s.warm||[]),...(s.strength||[]),...(s.hiit||[]),...(s.cool||[])]; const sets=all.reduce((acc,e)=>{ const m=/([0-9]+)\s*√ó\s*([0-9]+)/i.exec(e.fact||e.plan||''); return acc+(m?parseInt(m[1],10):0); },0); totalSets+=sets; all.forEach(e=>{ const r=parseFloat(e.rpe); if(!isNaN(r)){rpeSum+=r;rpeCnt++;}}); const tr=document.createElement('tr'); const first=all.slice(0,4).map(e=> `${e.name}${e.fact?` <span class='pill'>${e.fact}</span>`:''}`).join('<br>'); tr.innerHTML=`<td>${s.date}</td><td>${s.dayType}</td><td>${first}${all.length>4?`<div class='muted small'>‚Ä¶–∏ –µ—â—ë ${all.length-4}</div>`:''}</td><td>${sets}</td><td>${rpeCnt?(rpeSum/rpeCnt).toFixed(1):'‚Äî'}</td><td class='row' style='justify-content:flex-end;gap:8px'><button class='btn ghost' data-view='${s.id}'>–û—Ç–∫—Ä—ã—Ç—å</button><button class='btn bad' data-del='${s.id}'>–£–¥–∞–ª–∏—Ç—å</button></td>`; historyTbody.appendChild(tr); }); $('#kpiSessions').textContent=arr.length; $('#kpiSets').textContent=totalSets; $('#kpiRpe').textContent=rpeCnt?(rpeSum/rpeCnt).toFixed(1):'‚Äî'; $$('#historyTable [data-view]').forEach(b=> b.addEventListener('click',()=>{ const s=state.sessions.find(x=> x.id===b.dataset.view); if(!s) return; $$('.wrap nav button').find(x=> x.dataset.tab==='today')?.click(); dateInput.value=s.date; dayType.value=s.dayType; descInput.value=s.desc||''; reportText.value=s.report||''; Object.values(tables).forEach(tb=> tb.innerHTML=''); (s.warm||[]).forEach(i=> addRow('warm',i)); (s.strength||s.exercises||[]).forEach(i=> addRow('strength',i)); (s.hiit||[]).forEach(i=> addRow('hiit',i)); (s.cool||s.cooldown||[]).forEach(i=> addRow('cool',i.name?i:{name:i})); window.scrollTo({top:0,behavior:'smooth'}); })); $$('#historyTable [data-del]').forEach(b=> b.addEventListener('click',()=>{ if(!confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç—É —Å–µ—Å—Å–∏—é?')) return; state.sessions=state.sessions.filter(s=> s.id!==b.dataset.del); saveState(); renderHistory(); })); }

    // ==== RPE modal
    $('#rpeHelp').addEventListener('click',()=> $('#rpeModal').showModal());
    $('#closeRpe').addEventListener('click',()=> $('#rpeModal').close());

    // ==== –ú—É—Å–∫—É–ª—å–Ω–∞—è –∫–∞—Ä—Ç–∞ –Ω–∞ –±–∞–∑–µ –ö–ê–†–¢–ò–ù–û–ö –∏–∑ /assets/pack/
    const IMG_BASES = ['/assets/pack/','./assets/pack/','assets/pack/'];
    const BASE_IMG = {front:'pered.gif', back:'zad.gif'}; // –∫–∞–∫ –≤ –∞—Ä—Ö–∏–≤–µ

    // –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ ¬´–∫–∞–Ω–æ–Ω–∏—á–µ—Å–∫–∞—è –≥—Ä—É–ø–ø–∞ ‚Üí —Ñ–∞–π–ª—ã-—Å–ª–æ–∏ (–ø–æ —Å—Ç–æ—Ä–æ–Ω–∞–º)¬ª
    const FILES = {
      '–≥—Ä—É–¥—å': {front:['gryd_4.gif']},
      '–¥–µ–ª—å—Ç—ã': {front:['sred_4.gif']},
      '–±–∏—Ü–µ–ø—Å': {front:['biceps_4.gif']},
      '—Ç—Ä–∏—Ü–µ–ø—Å': {back:['tric_z_4.gif']},
      '–ø—Ä–µ–¥–ø–ª–µ—á—å—è': {front:['predp_4.gif'], back:['predp_z_4.gif']},
      '–ø—Ä–µ—Å—Å': {front:['presss_4.gif']},
      '–Ω–∏–∑ –ø—Ä–µ—Å—Å–∞': {front:['podpoi_4.gif']},
      '–∫–æ—Å—ã–µ': {front:['kosie_4.gif']},
      '—Ç—Ä–∞–ø–µ—Ü–∏—è': {front:['trap_4.gif'], back:['trap_z_4.gif']},
      '—à–∏—Ä–æ—á–∞–π—à–∏–µ': {back:['verh_z_4.gif']},
      '—Ä–∞–∑–≥–∏–±–∞—Ç–µ–ª–∏ —Å–ø–∏–Ω—ã': {back:['poias_z_4.gif']},
      '—è–≥–æ–¥–∏—Ü—ã': {back:['iagod_z_4.gif']},
      '—Å—Ä–µ–¥–Ω—è—è —è–≥–æ–¥–∏—á–Ω–∞—è': {back:['iagod_z_4.gif']},
      '–∫–≤–∞–¥—Ä–∏—Ü–µ–ø—Å—ã': {front:['ppb_4.gif']},
      '–ø—Ä–∏–≤–æ–¥—è—â–∏–µ': {front:['vpb_4.gif'], back:['vpb_z_4.gif']},
      '–Ω–∞—Ä—É–∂–Ω–∞—è –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç—å –±–µ–¥—Ä–∞': {back:['npb_z_4.gif']},
      '–±–∏—Ü–µ–ø—Å –±–µ–¥—Ä–∞': {back:['zpb_z_4.gif']},
      '–∏–∫—Ä—ã': {front:['golen_4.gif'], back:['golen_z_4.gif']},
      '—à–µ—è': {front:['sheia_4.gif']}
    };

    // –°–∏–Ω–æ–Ω–∏–º—ã ‚Üí –∫–∞–Ω–æ–Ω–∏—á–µ—Å–∫–∏–π –∫–ª—é—á
    const SYN = [
      ['–≥—Ä—É–¥—å',['–≥—Ä—É–¥','chest','pector']],
      ['–¥–µ–ª—å—Ç—ã',['–ø–ª–µ—á–∏','–¥–µ–ª—å—Ç','deltoid']],
      ['–±–∏—Ü–µ–ø—Å',['–±–∏—Ü','biceps']],
      ['—Ç—Ä–∏—Ü–µ–ø—Å',['—Ç—Ä–∏—Ü','triceps']],
      ['–ø—Ä–µ–¥–ø–ª–µ—á—å—è',['–ø—Ä–µ–¥–ø–ª–µ—á','forearm']],
      ['–ø—Ä–µ—Å—Å',['–∫–æ—Ä','abs','–ø—Ä–µ—Å—Å','–ø—Ä—è–º–∞—è –º—ã—à—Ü–∞ –∂–∏–≤–æ—Ç–∞']],
      ['–Ω–∏–∑ –ø—Ä–µ—Å—Å–∞',['–Ω–∏–∂–Ω–∏–π –ø—Ä–µ—Å—Å','–Ω–∏–∂–Ω –ø—Ä–µ—Å—Å','–ø–æ–¥–ø–æ—è—Å']],
      ['–∫–æ—Å—ã–µ',['–∫–æ—Å','oblique']],
      ['—Ç—Ä–∞–ø–µ—Ü–∏—è',['—Ç—Ä–∞–ø','traps','–≤–µ—Ä—Ö —Ç—Ä–∞–ø–µ—Ü–∏–∏','—Å—Ä–µ–¥ —Ç—Ä–∞–ø–µ—Ü–∏–∏','–Ω–∏–∂ —Ç—Ä–∞–ø–µ—Ü–∏–∏']],
      ['—à–∏—Ä–æ—á–∞–π—à–∏–µ',['—à–∏—Ä–æ—á','lat','lats','–≤–µ—Ä—Ö —Å–ø–∏–Ω—ã']],
      ['—Ä–∞–∑–≥–∏–±–∞—Ç–µ–ª–∏ —Å–ø–∏–Ω—ã',['—ç—Ä–µ–∫—Ç–æ—Ä','erector','–ø–æ—è—Å–Ω–∏—Ü–∞']],
      ['—è–≥–æ–¥–∏—Ü—ã',['—è–≥–æ–¥','glute','glutes']],
      ['—Å—Ä–µ–¥–Ω—è—è —è–≥–æ–¥–∏—á–Ω–∞—è',['—Å—Ä–µ–¥–Ω—è—è —è–≥–æ–¥','glute medius']],
      ['–∫–≤–∞–¥—Ä–∏—Ü–µ–ø—Å—ã',['–∫–≤–∞–¥—Ä','quads']],
      ['–ø—Ä–∏–≤–æ–¥—è—â–∏–µ',['–∞–¥–¥—É–∫—Ç','adductor']],
      ['–Ω–∞—Ä—É–∂–Ω–∞—è –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç—å –±–µ–¥—Ä–∞',['–∞–±–¥—É–∫—Ç','–Ω–∞—Ä—É–∂ –±–µ–¥—Ä–∞',' abductors']],
      ['–±–∏—Ü–µ–ø—Å –±–µ–¥—Ä–∞',['—Ö–∞–º—Å—Ç—Ä','hamstring','–∑–∞–¥–Ω—è—è –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç—å –±–µ–¥—Ä–∞','–∑–∞–¥ –±–µ–¥—Ä–∞']],
      ['–∏–∫—Ä—ã',['–≥–æ–ª–µ–Ω–∏','–∏–∫—Ä','calf','calves']],
      ['—à–µ—è',['neck','—à–µ–π']]
    ];

    function canonicalGroups(text){
      const t=(text||'').toLowerCase(); const res=new Set();
      SYN.forEach(([canon,arr])=>{ if(t.includes(canon)) res.add(canon); else if(arr.some(a=> t.includes(a))) res.add(canon); });
      return Array.from(res);
    }

    function showMuscles(musclesText){
      const groups = canonicalGroups(musclesText);
      buildAtlas(groups).then(ok=>{
        if(!ok){ // –µ—Å–ª–∏ –Ω–µ –Ω–∞—à–ª–∏ –Ω–∏ –æ–¥–Ω–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è ‚Äî –ø–æ–∫–∞–∂–µ–º fallback SVG –∏–∑ –ø—Ä–æ—à–ª–æ–π –≤–µ—Ä—Å–∏–∏
          showFallbackSVG(groups);
        }
      });
    }

    function pickUrl(filename){
      return new Promise(resolve=>{
        let i=0; const tryNext=()=>{
          if(i>=IMG_BASES.length) return resolve(null);
          const url = IMG_BASES[i++] + filename;
          const img = new Image(); img.onload=()=> resolve(url); img.onerror=tryNext; img.src=url+`?v=${Date.now()}`; // bust cache
        }; tryNext();
      });
    }

    async function buildAtlas(groups){
      const fig = $('#muscleFigure'); fig.innerHTML='';
      const frontWrap = document.createElement('div'); frontWrap.className='panelAtlas';
      const backWrap = document.createElement('div'); backWrap.className='panelAtlas';
      fig.appendChild(frontWrap); fig.appendChild(backWrap);

      // helpers
      const loadImg=(url,cls)=> new Promise(res=>{ if(!url) return res(null); const im=new Image(); im.className=cls||''; im.onload=()=>res(im); im.onerror=()=>res(null); im.src=url+`?v=${Date.now()}`; });

      // –ü–æ–¥–ª–æ–∂–∫–∏: –∑–∞–¥–∞—ë–º aspect-ratio –∫–æ—Ä–ø—É—Å–∞ –ø–æ –Ω–∞—Ç—É—Ä–∞–ª—å–Ω—ã–º —Ä–∞–∑–º–µ—Ä–∞–º
      const frontBaseUrl = await pickUrl(BASE_IMG.front);
      const backBaseUrl  = await pickUrl(BASE_IMG.back);
      const frontBaseImg = await loadImg(frontBaseUrl,'base');
      const backBaseImg  = await loadImg(backBaseUrl,'base');
      if(frontBaseImg){ frontWrap.style.aspectRatio = `${frontBaseImg.naturalWidth} / ${frontBaseImg.naturalHeight}`; frontWrap.appendChild(frontBaseImg);} else {frontWrap.innerHTML='<div class="muted small" style="padding:12px">–ù–µ—Ç –ø–æ–¥–ª–æ–∂–∫–∏ (pered.gif)</div>'}
      if(backBaseImg){ backWrap.style.aspectRatio = `${backBaseImg.naturalWidth} / ${backBaseImg.naturalHeight}`; backWrap.appendChild(backBaseImg);} else {backWrap.innerHTML='<div class="muted small" style="padding:12px">–ù–µ—Ç –ø–æ–¥–ª–æ–∂–∫–∏ (zad.gif)</div>'}

      const ft=document.createElement('div'); ft.className='title'; ft.textContent='–°–ü–ï–†–ï–î–ò'; frontWrap.appendChild(ft);
      const bt=document.createElement('div'); bt.className='title'; bt.textContent='–°–ó–ê–î–ò'; backWrap.appendChild(bt);

      // –°–ª–æ–∏ –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –≥—Ä—É–ø–ø (—Ä–∞—Å—Ç—è–≥–∏–≤–∞–µ–º –ø–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—É 1:1 ‚Äî –±–æ–ª—å—à–µ –Ω–µ "—Å—ä–µ–∑–∂–∞—é—Ç")
      let anyLayer=false;
      for(const g of groups){
        const files = FILES[g]; if(!files) continue;
        if(files.front){ for(const f of files.front){ const url=await pickUrl(f); const im=await loadImg(url,'layer'); if(im){ frontWrap.appendChild(im); anyLayer=true; }} }
        if(files.back){ for(const f of files.back){ const url=await pickUrl(f); const im=await loadImg(url,'layer'); if(im){ backWrap.appendChild(im); anyLayer=true; }} }
      }

      // –õ–µ–≥–µ–Ω–¥–∞
      $('#muscleLegend').innerHTML = groups.map(g=>`<span class='tag'>${g}</span>`).join('') || '<span class="muted small">–£–∫–∞–∂–∏ –≥—Ä—É–ø–ø—ã –≤ –∫–æ–ª–æ–Ω–∫–µ ¬´–ú—ã—à—Ü—ã¬ª (–Ω–∞–ø—Ä.: –≥—Ä—É–¥—å/—Ç—Ä–∏—Ü–µ–ø—Å; —à–∏—Ä–æ—á–∞–π—à–∏–µ/—Ä–æ–º–±–æ–≤–∏–¥–Ω—ã–µ).</span>';
      $('#muscleModal').showModal();
      return anyLayer || (frontBaseUrl||backBaseUrl);
    }

    // –ü—Ä–æ—Å—Ç–µ–π—à–∏–π SVG-—Ñ–æ–ª–ª–±–µ–∫ (–µ—Å–ª–∏ –∫–∞—Ä—Ç–∏–Ω–æ–∫ –Ω–µ—Ç)
    function showFallbackSVG(groups){
      const fig=$('#muscleFigure');
      fig.innerHTML = `<svg viewBox='0 0 740 320' width='100%' style='background:#0b1220;border:1px solid #22314a;border-radius:10px'>
        <text x='370' y='160' text-anchor='middle' fill='#9aa3b2'>–ù–µ—Ç –∫–∞—Ä—Ç–∏–Ω–æ–∫ –≤ /assets/pack ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —É–ø—Ä–æ—â—ë–Ω–Ω–∞—è —Å—Ö–µ–º–∞</text>
      </svg>`;
      $('#muscleLegend').innerHTML = groups.map(g=>`<span class='tag'>${g}</span>`).join('');
      $('#muscleModal').showModal();
    }

    $('#closeRpe').addEventListener('click',()=> $('#rpeModal').close());
    $('#closeMuscle').addEventListener('click',()=> $('#muscleModal').close());

    // ==== –ù–∞—Å—Ç—Ä–æ–π–∫–∏/–®–∞–±–ª–æ–Ω—ã
    const templatesGrid=$('#templatesGrid'); const nameInput=$('#nameInput'); const goalInput=$('#goalInput'); const gearInput=$('#gearInput');
    function renderTemplates(){ templatesGrid.innerHTML=''; state.templates.forEach(t=>{ const card=document.createElement('div'); card.className='kpi'; card.innerHTML=`<div class='tag'>–®–∞–±–ª–æ–Ω</div><h3 style='font-size:16px;margin:4px 0 8px 0'>${t.title}</h3><div class='small muted'>${[...t.warm||[],...t.strength||[],...t.hiit||[],...t.cool||[]].slice(0,5).map(i=> `${i.name} <span class='pill'>${i.plan||''}</span>`).join('<br>')}</div><div class='row' style='justify-content:flex-end;margin-top:10px;gap:8px'><button class='btn' data-load='${t.id}'>–ó–∞–≥—Ä—É–∑–∏—Ç—å –≤ –°–µ–≥–æ–¥–Ω—è</button><button class='btn ghost' data-edit='${t.id}'>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button></div>`; templatesGrid.appendChild(card); }); $$('#templatesGrid [data-load]').forEach(btn=> btn.addEventListener('click',()=>{ const t=state.templates.find(x=> x.id===btn.dataset.load); if(!t) return; $$('.wrap nav button').find(b=> b.dataset.tab==='today')?.click(); Object.values(tables).forEach(tb=> tb.innerHTML=''); (t.warm||[]).forEach(i=> addRow('warm',i)); (t.strength||[]).forEach(i=> addRow('strength',i)); (t.hiit||[]).forEach(i=> addRow('hiit',i)); (t.cool||[]).forEach(i=> addRow('cool',i)); dayType.value=t.title.split(' ‚Äî ')[0]; descInput.value=t.desc||''; window.scrollTo({top:0,behavior:'smooth'}); })); $$('#templatesGrid [data-edit]').forEach(btn=> btn.addEventListener('click',()=>{ const t=state.templates.find(x=> x.id===btn.dataset.edit); if(!t) return; const txt=prompt('–û–¥–Ω–∞ —Å—Ç—Ä–æ–∫–∞ = ¬´–ù–∞–∑–≤–∞–Ω–∏–µ ‚Äî –º—ã—à—Ü—ã ‚Äî –ø–ª–∞–Ω ‚Äî tip:—Ç–µ—Ö–Ω–∏–∫–∞ ‚Äî note:–∑–∞–º–µ—Ç–∫–∞¬ª', (t.strength||[]).map(i=> `${i.name} ‚Äî ${i.muscles||''} ‚Äî ${i.plan||''}${i.tip?` ‚Äî tip:${i.tip}`:''}`).join('\n')); if(txt===null) return; const items=[]; txt.split(/\n+/).forEach(line=>{ const parts=line.split('‚Äî').map(s=> s&&s.trim()); if(!parts[0]) return; const obj={name:parts[0]}; if(parts[1] && !/^tip:|^note:/.test(parts[1])) obj.muscles=parts[1]; const rest=parts.slice(obj.muscles?2:1).join(' ‚Äî '); rest.split(/\s‚Äî\s|\s;\s/).forEach(tk=>{ const m=tk.match(/^tip:(.*)/i); const n=tk.match(/^note:(.*)/i); if(m) obj.tip=m[1].trim(); else if(n) obj.note=n[1].trim(); else if(!obj.plan) obj.plan=tk.trim(); }); items.push(obj); }); t.strength=items; saveState(); renderTemplates(); })); }
    function renderSettings(){ nameInput.value=state.profile.name||''; goalInput.value=state.profile.goal||''; gearInput.value=state.profile.gear||''; }
    $('#saveProfile').addEventListener('click',()=>{ state.profile.name=nameInput.value.trim(); state.profile.goal=goalInput.value.trim(); state.profile.gear=gearInput.value.trim(); saveState(); alert('–ü—Ä–æ—Ñ–∏–ª—å —Å–æ—Ö—Ä–∞–Ω—ë–Ω ‚úÖ'); });
    $('#wipeAll').addEventListener('click',()=>{ if(!confirm('–°—Ç–µ—Ä–µ—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –≤ —ç—Ç–æ–º –±—Ä–∞—É–∑–µ—Ä–µ?')) return; localStorage.removeItem(KEY); location.reload(); });

    function esc(s=''){return s.replace(/[&<>"']/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;','\'':'&#39;'}[m]));}
    function download(filename,text){ const blob=new Blob([text],{type:'application/octet-stream'}); const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download=filename; a.click(); URL.revokeObjectURL(a.href); }
  })();
  </script>
</body>
</html>
